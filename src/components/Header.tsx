import styles from './Header.module.css';
import React from 'react';

function Header() {
    const [mobileMenuActive, setMobileMenuActive] = React.useState(false);
    const mobileMenu = React.useRef<HTMLDivElement>(null);
    const menuButton = React.useRef<HTMLDivElement>(null);

    function toggleMobileMenuActive() {
        setMobileMenuActive(!mobileMenuActive);
    }

    React.useEffect(() => {
        window.addEventListener('click', deactiveMobileMenu);
        return () => {
            window.removeEventListener('click', deactiveMobileMenu);
        }
    }, [mobileMenuActive]);

    function deactiveMobileMenu(event: MouseEvent) {    
        if (shouldDeactiveMobileMenu(event)) {
            setMobileMenuActive(false);
        }
    }

    function shouldDeactiveMobileMenu(event: MouseEvent) {
        return (
            mobileMenuActive &&
            event.target instanceof Element &&
            isOutOfMobileMenu(event.target)
        );
    }

    function isOutOfMobileMenu(element: Element) {
        return (
            mobileMenu.current &&
            menuButton.current &&
            ! menuButton.current.contains(element) &&
            ! mobileMenu.current.contains(element)
        );
    }

    return (
        <header className={styles.header} data-testid="header">
            <nav className={styles.navigation}>
                <a href="/" className={styles.logo}>
                    <svg id="bookinvideo-svg" xmlns="http://www.w3.org/2000/svg" width="145" height="17" fill="none">
                        <path d="M4.368 16l-1.968.096-1.488.144.168-1.584c.688-.128 1.152-.32 1.392-.576.24-.272.36-.72.36-1.344l.024-9.408c0-.448-.056-.76-.168-.936s-.312-.264-.6-.264l-.48.024-.336.024-.168-.192.216-1.44 1.392.024 1.92.024 2.04-.048L8.256.472c1.648 0 2.904.32 3.768.96s1.296 1.56 1.296 2.76c0 .8-.232 1.512-.696 2.136-.448.608-1.08 1.12-1.896 1.536 1.04.272 1.864.704 2.472 1.296.624.592.936 1.352.936 2.28 0 .944-.264 1.784-.792 2.52-.512.72-1.24 1.28-2.184 1.68-.928.4-2.008.6-3.24.6-.192 0-.456-.016-.792-.048l-.768-.072-.96-.072L4.368 16zm1.656-8.832l1.152.12 1.152.096c0 .032.152-.048.456-.24.32-.208.6-.504.84-.888.256-.384.384-.872.384-1.464 0-.816-.272-1.416-.816-1.8S7.8 2.416 6.648 2.416c-.16 0-.272.032-.336.096-.048.064-.08.184-.096.36l-.192 4.296zm-.144 5.64c0 .512.176.88.528 1.104.352.208.936.312 1.752.312.784 0 1.4-.216 1.848-.648s.672-1.024.672-1.776c0-.656-.216-1.2-.648-1.632-.416-.448-1.024-.76-1.824-.936l-2.232.024-.096 3.552zm15.923 3.408c-1.792 0-3.2-.52-4.224-1.56-1.008-1.056-1.512-2.512-1.512-4.368 0-1.328.264-2.48.792-3.456a5.44 5.44 0 0 1 2.256-2.28c.992-.528 2.144-.792 3.456-.792 1.824 0 3.24.52 4.248 1.56 1.008 1.024 1.512 2.464 1.512 4.32 0 1.328-.272 2.488-.816 3.48a5.55 5.55 0 0 1-2.28 2.304c-.976.528-2.12.792-3.432.792zm.48-1.8c.864 0 1.528-.32 1.992-.96s.696-1.568.696-2.784c0-1.632-.256-2.856-.768-3.672-.496-.816-1.216-1.224-2.16-1.224-.848 0-1.496.312-1.944.936s-.672 1.552-.672 2.784c0 1.648.24 2.88.72 3.696.496.816 1.208 1.224 2.136 1.224zm13.531 1.8c-1.792 0-3.2-.52-4.224-1.56-1.008-1.056-1.512-2.512-1.512-4.368 0-1.328.264-2.48.792-3.456a5.44 5.44 0 0 1 2.256-2.28c.992-.528 2.144-.792 3.456-.792 1.824 0 3.24.52 4.248 1.56 1.008 1.024 1.512 2.464 1.512 4.32 0 1.328-.272 2.488-.816 3.48a5.55 5.55 0 0 1-2.28 2.304c-.976.528-2.12.792-3.432.792zm.48-1.8c.864 0 1.528-.32 1.992-.96s.696-1.568.696-2.784c0-1.632-.256-2.856-.768-3.672-.496-.816-1.216-1.224-2.16-1.224-.848 0-1.496.312-1.944.936s-.672 1.552-.672 2.784c0 1.648.24 2.88.72 3.696.496.816 1.208 1.224 2.136 1.224zm9.499-8.136c0-.4-.048-.656-.144-.768-.096-.128-.288-.192-.576-.192h-.576l-.12-.192.168-1.176 2.76.024 1.512-.048 1.344-.072-.096 1.368c-.496.096-.824.216-.984.36-.16.128-.248.368-.264.72l-.192 7.104c-.016.512.024.856.12 1.032.112.16.32.24.624.24a3.98 3.98 0 0 0 .48-.024l.264-.024.096.144-.168 1.272c-.224 0-.64-.008-1.248-.024L47.089 16l-1.752.024-1.104.024.192-1.296c.56-.08.92-.208 1.08-.384.176-.192.264-.56.264-1.104l.024-6.984zm6.024.504c.32-.32.48-.624.48-.912 0-.192-.08-.328-.24-.408-.144-.096-.392-.152-.744-.168l-.072-.144.168-1.248 1.032.048 1.512.024 1.416-.024.984-.048.168.216-.168 1.152a4.55 4.55 0 0 0-1.224.792c-.384.336-.864.84-1.44 1.512l-1.8 1.896 2.448 3.648c.384.576.736.992 1.056 1.248.336.24.72.376 1.152.408l.144.192-.168 1.104-1.128.096-1.32.12a2.04 2.04 0 0 1-1.176-.36c-.336-.256-.68-.656-1.032-1.2l-2.88-4.632.048-.456 2.784-2.856zm35.045 9.576l-1.536-5.616-2.04-7.152c-.144-.496-.36-.856-.648-1.08-.272-.24-.656-.368-1.152-.384l-.096-.168.168-1.416 1.224.024 1.8.024L86.934.52l1.68-.12.12.192-.096 1.416-1.224.192c-.256.048-.432.128-.528.24-.08.112-.12.28-.12.504 0 .352.312 1.864.936 4.536l1.296 5.424h.36c.384-.976.992-2.808 1.824-5.496l1.248-4.56c0-.272-.096-.464-.288-.576-.176-.112-.496-.168-.96-.168h-.96l-.096-.168.144-1.464 1.464.072 2.088.048L95.55.568l1.056-.024-.168 1.56c-.4.064-.68.176-.84.336-.16.144-.32.448-.48.912l-4.44 12.528-3.816.48zm10.981-1.536c.576-.112.952-.264 1.128-.456.176-.208.264-.576.264-1.104l.024-6.984c0-.384-.048-.64-.144-.768s-.288-.192-.576-.192h-.648l-.096-.192.12-1.176 2.856.024 1.56-.048 1.368-.072-.12 1.368c-.496.064-.824.16-.984.288-.144.128-.232.368-.264.72l-.24 7.176c0 .512.048.856.144 1.032.096.16.296.24.6.24l.504-.024.288-.024.12.144-.168 1.272c-.224 0-.648-.008-1.272-.024L100.554 16l-1.632.048-1.224.096.144-1.32zm13.484 1.392l-1.296-.144-1.704-.072-1.512.072-1.08.12.12-1.416c.544-.08.912-.224 1.104-.432.192-.224.288-.6.288-1.128l.024-6.888c0-.4-.048-.664-.144-.792-.08-.144-.232-.216-.456-.216-.144 0-.28.008-.408.024l-.24.024-.12-.192.168-1.248 1.08.024 1.512.024 1.848-.024 1.32-.072c2.016 0 3.584.488 4.704 1.464s1.68 2.36 1.68 4.152c0 1.328-.288 2.504-.864 3.528-.576 1.008-1.392 1.792-2.448 2.352-1.04.56-2.232.84-3.576.84zm-.48-10.512c-.208 0-.352.032-.432.096-.064.064-.104.184-.12.36l-.24 7.032c0 .496.096.824.288.984.208.16.6.24 1.176.24 2.208 0 3.312-1.44 3.312-4.32 0-1.552-.32-2.672-.96-3.36s-1.648-1.032-3.024-1.032zm9.393 9.096c.544-.064.912-.208 1.104-.432.192-.24.288-.64.288-1.2l.024-6.84c0-.4-.04-.664-.12-.792-.08-.144-.248-.216-.504-.216l-.576.024-.144-.192.168-1.224 1.464.024 2.352.024 6.048-.216.168.216c-.048.208-.128.664-.24 1.368l-.216 2.136-1.992.12c0-.048.008-.144.024-.288l.024-.456c0-.352-.056-.6-.168-.744s-.328-.24-.648-.288c-.32-.064-.848-.096-1.584-.096-.432 0-.704.032-.816.096-.096.064-.152.224-.168.48l-.12 2.712h1.776l1.224-.048 1.056-.096.192.216-.288 1.728c-.176 0-.512-.008-1.008-.024l-1.536-.024a10.66 10.66 0 0 0-1.488.12l-.048 2.352c0 .352.024.6.072.744s.152.248.312.312c.16.048.432.072.816.072.8 0 1.384-.048 1.752-.144.368-.112.632-.304.792-.576.16-.288.288-.752.384-1.392l1.824-.144.192.216c-.048.192-.136.64-.264 1.344l-.288 2.232-.216.216-2.616-.072-3.6-.048-2.184.072-1.368.12.144-1.392zm17.772 1.416c-1.792 0-3.2-.52-4.224-1.56-1.008-1.056-1.512-2.512-1.512-4.368 0-1.328.264-2.48.792-3.456a5.44 5.44 0 0 1 2.256-2.28c.992-.528 2.144-.792 3.456-.792 1.824 0 3.24.52 4.248 1.56 1.008 1.024 1.512 2.464 1.512 4.32 0 1.328-.272 2.488-.816 3.48a5.55 5.55 0 0 1-2.28 2.304c-.976.528-2.12.792-3.432.792zm.48-1.8c.864 0 1.528-.32 1.992-.96s.696-1.568.696-2.784c0-1.632-.256-2.856-.768-3.672-.496-.816-1.216-1.224-2.16-1.224-.848 0-1.496.312-1.944.936s-.672 1.552-.672 2.784c0 1.648.24 2.88.72 3.696.496.816 1.208 1.224 2.136 1.224z" fill="#eee5e0"/>
                        <path className="middle_letters" d="M58.342 14.68c.704-.144 1.176-.344 1.416-.6.24-.272.36-.744.36-1.416V3.376c0-.496-.056-.824-.168-.984-.112-.176-.344-.264-.696-.264l-.84.024-.12-.192.192-1.392 3.312.024c.528 0 1.648-.056 3.36-.168l-.12 1.584c-.608.08-1.016.208-1.224.384-.192.16-.304.464-.336.912l-.312 9.528c0 .656.064 1.096.192 1.32s.376.336.744.336c.176 0 .528-.024 1.056-.072l.096.144-.216 1.512-.864-.024L61.51 16c-.736 0-1.84.072-3.312.216l.144-1.536zm18.57-8.568c-.016-.304-.072-.512-.168-.624s-.256-.168-.48-.168h-.672l-.072-.168.12-1.248 1.08.048 1.608.024 1.488-.024.936-.072-.096 1.368c-.432.064-.744.184-.936.36-.176.176-.272.448-.288.816l-.288 9.768-2.376.24-3.432-4.896-2.016-2.832h-.216v5.112c0 .336.048.568.144.696.112.128.296.192.552.192a4.59 4.59 0 0 0 .456-.024l.36-.024.12.12-.216 1.296c-.192 0-.552-.016-1.08-.048L69.88 16l-1.512.048-1.032.096.168-1.368c.4-.048.688-.16.864-.336s.272-.456.288-.84l.264-7.152c0-.4-.104-.672-.312-.816-.208-.16-.632-.28-1.272-.36l-.168-.192.144-1.2.984.072 1.416.024 1.272-.024.768-.048 3 4.488 1.992 2.736h.216l-.048-5.016z" fill="#d79c6b"/>
                    </svg>
                </a>

                <div 
                    data-testid="header_menu"
                    className={`
                        ${styles.header_menu} 
                        ${mobileMenuActive ? styles.active : ''}
                    `}
                >
                    <div 
                        className={styles.hamburguer_menu} 
                        onClick={toggleMobileMenuActive}
                        data-testid="mobile_menu_button"
                        ref={menuButton}
                    >
                        <span className={styles.line}></span>
                    </div>

                    <div className={styles.links_container} ref={mobileMenu}>
                        <div className={styles.links_wrapper}>
                            <a href="/cursos" className={styles.link}>Curso</a>
                            <a href="/plano" className={styles.link}>Inscreva-se</a>
                            <a href="/contato" className={`${styles.link} ${styles.contact}`}>Contato</a>
                            <a href="/entrar" className={`${styles.link} ${styles.login}`}>Login</a>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
    );
}

export default Header;